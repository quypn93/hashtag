@model HomeIndexViewModel
@using Microsoft.AspNetCore.Localization
@using Microsoft.Extensions.Localization
@using HashTag
@using HashTag.Helpers
@inject IStringLocalizer<SharedResource> Localizer
@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var currentCulture = requestCulture?.RequestCulture.UICulture.Name ?? "vi";
    var isEnglish = currentCulture.StartsWith("en");

    ViewData["Title"] = Localizer["Home_PageTitle"];
    ViewData["Description"] = Localizer["Home_PageDescription"];
    ViewData["Keywords"] = Localizer["Home_PageKeywords"];
    Layout = "_LayoutPublic";
}

<div class="home-hero text-center py-5">
    <div class="container">
        <h1 class="display-3 fw-bold mb-3">
            <i class="bi bi-hash-square text-primary"></i> @Localizer["Home_HeroTitle"]
        </h1>
        <p class="lead text-muted mb-5">
            @Localizer["Home_HeroSubtitle"]
        </p>

        <div class="search-container search-container-max mx-auto p-0 p-sm-2">
            <form asp-controller="Hashtag" asp-action="Search" method="get" class="position-relative">
                <div class="input-group search-input-height shadow-lg rounded-pill overflow-hidden">
                    <span class="input-group-text bg-white border-0 ps-4 d-flex align-items-center">
                        <i class="bi bi-search text-primary fs-4"></i>
                    </span>
                    <input
                        type="text"
                        class="form-control search-input-font border-0 ps-2 fs-5"
                        id="searchInput"
                        name="q"
                        placeholder="@Localizer["Home_SearchPlaceholder"]"
                        autocomplete="off"
                        required
                    />
                    <button class="btn btn-primary search-btn-radius px-5 border-0 fs-5 fw-semibold" type="submit">
                        <i class="bi bi-search me-2"></i>@Localizer["Home_SearchButton"]
                    </button>
                </div>

                <!-- Auto-suggest dropdown -->
                <div id="suggestionsDropdown" class="suggestions-dropdown list-group position-absolute w-100 mt-2 shadow-lg rounded-3"></div>
            </form>

            <div class="mt-4 text-muted">
                <i class="bi bi-lightbulb text-warning"></i>
                <small>@Localizer["Home_SearchTip"]</small>
            </div>
        </div>

        <div class="row mt-5 g-4">
            <div class="col-md-4">
                <a href="/Analytics/Growth" class="text-decoration-none">
                    <div class="card card-hashtag border-0 h-100 feature-card-hover feature-card-primary">
                        <div class="card-body text-center text-white p-4">
                            <div class="feature-icon bg-white bg-opacity-25 rounded-circle d-inline-flex align-items-center justify-content-center mb-3">
                                <i class="bi bi-graph-up-arrow fs-3"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">@Localizer["Home_Feature1_Title"]</h5>
                            <p class="card-text opacity-90">
                                @Localizer["Home_Feature1_Desc"]
                            </p>
                            <small class="d-block mt-2 opacity-75"><i class="bi bi-arrow-right-circle me-1"></i>@Localizer["Home_Feature1_Link"]</small>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-md-4">
                <a href="/" class="text-decoration-none">
                    <div class="card card-hashtag border-0 h-100 feature-card-hover feature-card-secondary">
                        <div class="card-body text-center text-white p-4">
                            <div class="feature-icon bg-white bg-opacity-25 rounded-circle d-inline-flex align-items-center justify-content-center mb-3">
                                <i class="bi bi-database fs-3"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">@Localizer["Home_Feature2_Title"]</h5>
                            <p class="card-text opacity-90">
                                @Localizer["Home_Feature2_Desc"]
                            </p>
                            <small class="d-block mt-2 opacity-75"><i class="bi bi-arrow-right-circle me-1"></i>@Localizer["Home_Feature2_Link"]</small>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-md-4">
                <a href="/Hashtag/Generator" class="text-decoration-none">
                    <div class="card card-hashtag border-0 h-100 feature-card-hover feature-card-info">
                        <div class="card-body text-center text-white p-4">
                            <div class="feature-icon bg-white bg-opacity-25 rounded-circle d-inline-flex align-items-center justify-content-center mb-3">
                                <i class="bi bi-stars fs-3"></i>
                            </div>
                            <h5 class="card-title fw-bold mb-3">@Localizer["Home_Feature3_Title"]</h5>
                            <p class="card-text opacity-90">
                                @Localizer["Home_Feature3_Desc"]
                            </p>
                            <small class="d-block mt-2 opacity-75"><i class="bi bi-arrow-right-circle me-1"></i>@Localizer["Home_Feature3_Link"]</small>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <!-- Value Propositions -->
        <div class="row mt-5 text-center">
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="value-card p-4 h-100">
                    <i class="bi bi-clock-history fs-1 text-primary mb-3"></i>
                    <h5 class="fw-bold">@Localizer["Home_Value1_Title"]</h5>
                    <p class="text-muted small">@Localizer["Home_Value1_Desc"]</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="value-card p-4 h-100">
                    <i class="bi bi-shield-check fs-1 text-success mb-3"></i>
                    <h5 class="fw-bold">@Localizer["Home_Value2_Title"]</h5>
                    <p class="text-muted small">@Localizer["Home_Value2_Desc"]</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="value-card p-4 h-100">
                    <i class="bi bi-graph-up-arrow fs-1 text-warning mb-3"></i>
                    <h5 class="fw-bold">@Localizer["Home_Value3_Title"]</h5>
                    <p class="text-muted small">@Localizer["Home_Value3_Desc"]</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="value-card p-4 h-100">
                    <i class="bi bi-grid-3x3-gap fs-1 text-info mb-3"></i>
                    <h5 class="fw-bold">@Localizer["Home_Value4_Title"]</h5>
                    <p class="text-muted small">@Localizer["Home_Value4_Desc"]</p>
                </div>
            </div>
        </div>

        <!-- How It Works Section -->
        <div class="row mt-5 mb-4">
            <div class="col-lg-10 mx-auto">
                <div class="text-center mb-5">
                    <h2 class="fw-bold mb-3">
                        <i class="bi bi-lightbulb text-warning me-2"></i>
                        @Localizer["Home_HowToUseTitle"]
                    </h2>
                    <p class="text-muted">@Localizer["Home_HowToUseSubtitle"]</p>
                </div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="how-it-works-card text-center p-4 h-100 border rounded-4 shadow-sm">
                            <div class="step-number step-number-primary mx-auto mb-3">
                                <span class="text-white fw-bold fs-4">1</span>
                            </div>
                            <h5 class="fw-bold mb-3">@Localizer["Home_Step1_Title"]</h5>
                            <p class="text-muted small">
                                @Localizer["Home_Step1_Desc"]
                            </p>
                            <div class="mt-3">
                                <i class="bi bi-grid-3x3-gap text-primary icon-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="how-it-works-card text-center p-4 h-100 border rounded-4 shadow-sm">
                            <div class="step-number step-number-secondary mx-auto mb-3">
                                <span class="text-white fw-bold fs-4">2</span>
                            </div>
                            <h5 class="fw-bold mb-3">@Localizer["Home_Step2_Title"]</h5>
                            <p class="text-muted small">
                                @Localizer["Home_Step2_Desc"]
                            </p>
                            <div class="mt-3">
                                <i class="bi bi-bar-chart-line text-success icon-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="how-it-works-card text-center p-4 h-100 border rounded-4 shadow-sm">
                            <div class="step-number step-number-info mx-auto mb-3">
                                <span class="text-white fw-bold fs-4">3</span>
                            </div>
                            <h5 class="fw-bold mb-3">@Localizer["Home_Step3_Title"]</h5>
                            <p class="text-muted small">
                                @Localizer["Home_Step3_Desc"]
                            </p>
                            <div class="mt-3">
                                <i class="bi bi-rocket-takeoff text-warning icon-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info border-0 shadow-sm mt-4 rounded-4" role="alert">
                    <div class="d-flex align-items-start">
                        <i class="bi bi-info-circle-fill me-3 mt-1 icon-lg"></i>
                        <div>
                            <h6 class="fw-bold mb-2">ðŸ’¡ @Localizer["Home_ProTip_Title"]</h6>
                            <p class="mb-0 small">
                                @Localizer["Home_ProTip_Desc"]
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top 10 Trending Hashtags -->
        <div class="mt-5">
            <div class="card border-0 shadow-lg rounded-4">
                <div class="card-header card-header-gradient-primary text-white py-3">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <div class="d-flex align-items-center gap-3">
                            <h4 class="mb-0 fw-bold text-black">
                                <i class="bi bi-fire me-2"></i>@Localizer["Home_Top10Trending"]
                            </h4>
                            @if (Model.SelectedCategoryId.HasValue)
                            {
                                var selectedCategory = Model.Categories.FirstOrDefault(c => c.Id == Model.SelectedCategoryId.Value);
                                if (selectedCategory != null)
                                {
                                    <span id="categoryLabel" class="badge bg-white bg-opacity-25 px-3 py-2">
                                        <i class="bi bi-tag-fill me-1"></i>
                                        @(!isEnglish && !string.IsNullOrEmpty(selectedCategory.DisplayNameVi) ? selectedCategory.DisplayNameVi : selectedCategory.Name)
                                    </span>
                                }
                            }
                        </div>
                        <select id="categorySelect" class="form-select form-select-sm border-white text-dark min-w-200" onchange="filterByCategory(this)">
                            <option value="">@Localizer["Home_AllCategories"]</option>
                            @foreach (var category in Model.Categories)
                            {
                                var catDisplayName = !isEnglish && !string.IsNullOrEmpty(category.DisplayNameVi)
                                    ? category.DisplayNameVi
                                    : category.Name;
                                <option value="@category.Id"
                                        data-slug="@category.Slug"
                                        data-name="@catDisplayName"
                                        selected="@(Model.SelectedCategoryId == category.Id)">
                                    @catDisplayName
                                </option>
                            }
                        </select>
                    </div>
                </div>
                <div class="card-body p-0">
                    @if (Model.TopHashtags.Any())
                    {
                        <div class="table-responsive">
                            <table id="hashtagTable" class="table table-hover mb-0 align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-4 w-60px">#</th>
                                        <th>Hashtag</th>
                                        <th class="text-center">@Localizer["Home_Table_Category"]</th>
                                        <th class="text-center">@Localizer["Home_Table_Views"]</th>
                                        <th class="text-center">@Localizer["Home_Table_Posts"]</th>
                                        <th class="text-center">@Localizer["Home_Table_Difficulty"]</th>
                                        <th class="text-center">@Localizer["Home_Table_Rank"]</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @for (int i = 0; i < Model.TopHashtags.Count; i++)
                                    {
                                        var hashtag = Model.TopHashtags[i];
                                        var viewCountFormatted = hashtag.LatestViewCount.HasValue && hashtag.LatestViewCount > 0
                                            ? (hashtag.LatestViewCount.Value >= 1_000_000_000
                                                ? $"{hashtag.LatestViewCount.Value / 1_000_000_000.0:F1}B"
                                                : hashtag.LatestViewCount.Value >= 1_000_000
                                                    ? $"{hashtag.LatestViewCount.Value / 1_000_000.0:F1}M"
                                                    : hashtag.LatestViewCount.Value >= 1000
                                                        ? $"{hashtag.LatestViewCount.Value / 1000.0:F1}K"
                                                        : hashtag.LatestViewCount.Value.ToString("N0"))
                                            : "-";

                                        var postCountFormatted = hashtag.LatestPostCount.HasValue && hashtag.LatestPostCount > 0
                                            ? (hashtag.LatestPostCount.Value >= 1_000_000_000
                                                ? $"{hashtag.LatestPostCount.Value / 1_000_000_000.0:F1}B"
                                                : hashtag.LatestPostCount.Value >= 1_000_000
                                                    ? $"{hashtag.LatestPostCount.Value / 1_000_000.0:F1}M"
                                                    : hashtag.LatestPostCount.Value >= 1000
                                                        ? $"{hashtag.LatestPostCount.Value / 1000.0:F1}K"
                                                        : hashtag.LatestPostCount.Value.ToString("N0"))
                                            : "-";

                                        var difficultyBadge = hashtag.DifficultyLevel switch
                                        {
                                            "Easy" => "badge bg-success",
                                            "Medium" => "badge bg-warning",
                                            "Hard" => "badge bg-danger",
                                            "Very Hard" => "badge bg-dark",
                                            _ => "badge bg-secondary"
                                        };

                                        var difficultyVi = hashtag.DifficultyLevel switch
                                        {
                                            "Easy" => Localizer["Difficulty_Low"].Value,
                                            "Medium" => Localizer["Difficulty_Medium"].Value,
                                            "Hard" => Localizer["Difficulty_High"].Value,
                                            "Very Hard" => Localizer["Difficulty_VeryHigh"].Value,
                                            _ => hashtag.DifficultyLevel
                                        };

                                        var rankBadge = i < 3 ? "badge bg-warning text-dark" : "badge bg-secondary";

                                        <tr class="clickable-row" onclick="window.location.href='/hashtag/@hashtag.Tag'">
                                            <td class="ps-4 fw-bold text-muted">@(i + 1)</td>
                                            <td>
                                                <a href="/hashtag/@hashtag.Tag" class="text-decoration-none">
                                                    <strong class="text-primary fs-5">@hashtag.TagDisplay</strong>
                                                    <div class="text-muted small">
                                                        <i class="bi bi-bar-chart"></i> @hashtag.TotalAppearances @Localizer["Home_Appearances"]
                                                    </div>
                                                </a>
                                            </td>
                                            <td class="text-center">
                                                @if (!string.IsNullOrEmpty(hashtag.CategoryName))
                                                {
                                                    <span class="badge bg-info">@hashtag.CategoryName</span>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">-</span>
                                                }
                                            </td>
                                            <td class="text-center">
                                                <strong class="text-danger">@viewCountFormatted</strong>
                                            </td>
                                            <td class="text-center">
                                                <strong class="text-success">@postCountFormatted</strong>
                                            </td>
                                            <td class="text-center">
                                                @if (!string.IsNullOrEmpty(hashtag.DifficultyLevel))
                                                {
                                                    <span class="@difficultyBadge">@difficultyVi</span>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">-</span>
                                                }
                                            </td>
                                            <td class="text-center">
                                                <span class="@rankBadge">#@hashtag.BestRank</span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5 text-muted">
                            <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                            <p>@Localizer["Home_NoHashtags"]</p>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="faq-section bg-gradient-vertical-light mt-5 py-5">
            <div class="container">
                <div class="row">
                    <div class="col-lg-10 mx-auto">
                        <div class="text-center mb-5">
                            <h2 class="fw-bold mb-3">
                                <i class="bi bi-question-circle text-primary me-2"></i>
                                @Localizer["Home_FAQTitle"]
                            </h2>
                            <p class="text-muted">@Localizer["Home_FAQSubtitle"]</p>
                        </div>

                        <div class="accordion accordion-flush" id="faqAccordion">
                            <!-- FAQ 1 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                        @Localizer["Home_FAQ1_Question"]
                                    </button>
                                </h3>
                                <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ1_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 2 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                        @Localizer["Home_FAQ2_Question"]
                                    </button>
                                </h3>
                                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ2_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 3 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                        @Localizer["Home_FAQ3_Question"]
                                    </button>
                                </h3>
                                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ3_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 4 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                        @Localizer["Home_FAQ4_Question"]
                                    </button>
                                </h3>
                                <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ4_Answer"]
                                        <ul class="mt-2 mb-0">
                                            <li>@Localizer["Home_FAQ4_Level1"]</li>
                                            <li>@Localizer["Home_FAQ4_Level2"]</li>
                                            <li>@Localizer["Home_FAQ4_Level3"]</li>
                                            <li>@Localizer["Home_FAQ4_Level4"]</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 5 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                        @Localizer["Home_FAQ5_Question"]
                                    </button>
                                </h3>
                                <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ5_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 6 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq6">
                                        @Localizer["Home_FAQ6_Question"]
                                    </button>
                                </h3>
                                <div id="faq6" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ6_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 7 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq7">
                                        @Localizer["Home_FAQ7_Question"]
                                    </button>
                                </h3>
                                <div id="faq7" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ7_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 8 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq8">
                                        @Localizer["Home_FAQ8_Question"]
                                    </button>
                                </h3>
                                <div id="faq8" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ8_Answer"]
                                        <ul class="mt-2 mb-0">
                                            <li>@Localizer["Home_FAQ8_Tip1"]</li>
                                            <li>@Localizer["Home_FAQ8_Tip2"]</li>
                                        </ul>
                                        @Localizer["Home_FAQ8_Warning"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 9 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq9">
                                        @Localizer["Home_FAQ9_Question"]
                                    </button>
                                </h3>
                                <div id="faq9" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ9_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 10 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq10">
                                        @Localizer["Home_FAQ10_Question"]
                                    </button>
                                </h3>
                                <div id="faq10" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ10_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 11 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq11">
                                        @Localizer["Home_FAQ11_Question"]
                                    </button>
                                </h3>
                                <div id="faq11" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ11_Answer"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 12 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq12">
                                        @Localizer["Home_FAQ12_Question"]
                                    </button>
                                </h3>
                                <div id="faq12" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ12_Answer"]
                                        <ul class="mt-2 mb-0">
                                            <li>@Localizer["Home_FAQ12_Vietnamese"]</li>
                                            <li>@Localizer["Home_FAQ12_English"]</li>
                                        </ul>
                                        @Localizer["Home_FAQ12_Tip"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 13 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq13">
                                        @Localizer["Home_FAQ13_Question"]
                                    </button>
                                </h3>
                                <div id="faq13" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ13_Answer"]
                                        <ol class="mt-2 mb-0">
                                            <li>@Localizer["Home_FAQ13_Step1"]</li>
                                            <li>@Localizer["Home_FAQ13_Step2"]</li>
                                            <li>@Localizer["Home_FAQ13_Step3"]</li>
                                        </ol>
                                        @Localizer["Home_FAQ13_Tip"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 14 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq14">
                                        @Localizer["Home_FAQ14_Question"]
                                    </button>
                                </h3>
                                <div id="faq14" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ14_Answer"]
                                        <ul class="mt-2 mb-0">
                                            <li>@Localizer["Home_FAQ14_Problem1"]</li>
                                            <li>@Localizer["Home_FAQ14_Problem2"]</li>
                                            <li>@Localizer["Home_FAQ14_Problem3"]</li>
                                        </ul>
                                        @Localizer["Home_FAQ14_Tip"]
                                    </div>
                                </div>
                            </div>

                            <!-- FAQ 15 -->
                            <div class="accordion-item border rounded-3 mb-3 shadow-sm">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq15">
                                        @Localizer["Home_FAQ15_Question"]
                                    </button>
                                </h3>
                                <div id="faq15" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        @Localizer["Home_FAQ15_Answer"]
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CTA after FAQ -->
                        <div class="alert alert-primary border-0 shadow-sm mt-4 rounded-4" role="alert">
                            <div class="d-flex align-items-start">
                                <i class="bi bi-lightbulb-fill me-3 mt-1" style="font-size: 1.5rem;"></i>
                                <div>
                                    <h6 class="fw-bold mb-2">@Localizer["Home_FAQ_CTA_Title"]</h6>
                                    <p class="mb-0 small">
                                        @Localizer["Home_FAQ_CTA_Desc"]
                                        <a href="#hashtagTable" class="text-decoration-none fw-bold ms-1">@Localizer["Home_FAQ_CTA_Link"]</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Blog Posts Section -->
        @if (Model.RecentBlogPosts != null && Model.RecentBlogPosts.Any())
        {
            <div class="blog-posts-section bg-gradient-vertical-light py-5">
                <div class="container">
                    <div class="row mb-4">
                        <div class="col-12 text-center">
                            <h2 class="fw-bold mb-3">
                                <i class="bi bi-journal-text text-primary me-2"></i>
                                @Localizer["Home_LatestPosts"]
                            </h2>
                            <p class="text-muted">@Localizer["Home_LatestPostsDesc"]</p>
                        </div>
                    </div>
                    <div class="row g-4">
                        @foreach (var post in Model.RecentBlogPosts)
                        {
                            <div class="col-md-4">
                                <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden hover-lift">
                                    @if (!string.IsNullOrEmpty(post.FeaturedImage))
                                    {
                                        <img src="@post.FeaturedImage" class="card-img-top blog-img-cover" alt="@post.Title">
                                    }
                                    else
                                    {
                                        <div class="card-img-top blog-placeholder"></div>
                                    }
                                    <div class="card-body d-flex flex-column">
                                        <div class="mb-2">
                                            @if (post.Category != null)
                                            {
                                                <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 rounded-pill">
                                                    @(!isEnglish && !string.IsNullOrEmpty(post.Category.DisplayNameVi) ? post.Category.DisplayNameVi : post.Category.Name)
                                                </span>
                                            }
                                        </div>
                                        <h5 class="card-title fw-bold mb-3">
                                            <a href="/blog/@post.Slug" class="text-decoration-none text-dark stretched-link">
                                                @post.Title
                                            </a>
                                        </h5>
                                        @if (!string.IsNullOrEmpty(post.Excerpt))
                                        {
                                            <p class="card-text text-muted small mb-3 flex-grow-1">
                                                @post.Excerpt
                                            </p>
                                        }
                                        <div class="d-flex justify-content-between align-items-center text-muted small mt-auto">
                                            <span>
                                                <i class="bi bi-person-circle me-1"></i>
                                                @post.Author
                                            </span>
                                            <span>
                                                <i class="bi bi-clock me-1"></i>
                                                @post.ReadingTimeMinutes @Localizer["Home_MinRead"]
                                            </span>
                                        </div>
                                        @if (post.PublishedAt.HasValue)
                                        {
                                            <div class="text-muted small mt-2">
                                                <i class="bi bi-calendar3 me-1"></i>
                                                @post.PublishedAt.Value.ToString("dd/MM/yyyy")
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="row mt-5">
                        <div class="col-12 text-center">
                            <a href="/blog" class="btn btn-gradient-primary btn-lg px-5 py-3 shadow-sm">
                                <i class="bi bi-arrow-right-circle me-2"></i>
                                @Localizer["Home_ViewAllPosts"]
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- SEO Content Section -->
        <div class="seo-content bg-gradient-vertical-dark mt-5 py-5">
            <div class="container">
                <div class="row">
                    <div class="col-lg-10 mx-auto">
                        <h2 class="mb-4">@Localizer["SEO_MainTitle"]</h2>

                        <h3 class="h5 fw-bold mt-4 mb-3">@Localizer["SEO_WhatIsHashtag"]</h3>
                        <p>
                            <strong>@Localizer["SEO_WhatIsHashtag_Text1"]</strong> @Localizer["SEO_WhatIsHashtag_Text2"]
                            <strong>@Localizer["SEO_WhatIsHashtag_Text3"]</strong> @Localizer["SEO_WhatIsHashtag_Text4"]
                        </p>

                        <h3 class="h5 fw-bold mt-4 mb-3">@Localizer["SEO_WhyUseTrendTag"]</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>@Localizer["SEO_Benefit1_Title"]</strong> @Localizer["SEO_Benefit1_Desc"]</li>
                                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>@Localizer["SEO_Benefit2_Title"]</strong> @Localizer["SEO_Benefit2_Desc"]</li>
                                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>@Localizer["SEO_Benefit3_Title"]</strong> @Localizer["SEO_Benefit3_Desc"]</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>@Localizer["SEO_Benefit4_Title"]</strong> @Localizer["SEO_Benefit4_Desc"]</li>
                                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>@Localizer["SEO_Benefit5_Title"]</strong> @Localizer["SEO_Benefit5_Desc"]</li>
                                    <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>@Localizer["SEO_Benefit6_Title"]</strong> @Localizer["SEO_Benefit6_Desc"]</li>
                                </ul>
                            </div>
                        </div>

                        <h3 class="h5 fw-bold mt-4 mb-3">@Localizer["SEO_HowToChoose"]</h3>
                        <p>@Localizer["SEO_HowToChoose_Intro"] <strong>@Localizer["SEO_HowToChoose_IntroStrong"]</strong>@Localizer["SEO_HowToChoose_IntroEnd"]</p>
                        <ol>
                            <li class="mb-2"><strong>@Localizer["SEO_HowToChoose_Step1"]</strong> @Localizer["SEO_HowToChoose_Step1_Desc"]</li>
                            <li class="mb-2"><strong>@Localizer["SEO_HowToChoose_Step2"]</strong> @Localizer["SEO_HowToChoose_Step2_Desc"]</li>
                            <li class="mb-2"><strong>@Localizer["SEO_HowToChoose_Step3"]</strong> @Localizer["SEO_HowToChoose_Step3_Desc"]</li>
                        </ol>
                        <p class="text-muted small">
                            <i class="bi bi-lightbulb-fill text-warning me-1"></i>
                            <strong>@Localizer["SEO_ProTip"]</strong> @Localizer["SEO_ProTip_Text"]
                        </p>

                        <h3 class="h5 fw-bold mt-4 mb-3">@Localizer["SEO_PopularCategories"]</h3>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <ul class="list-unstyled category-links">
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "giao-duc")" class="text-decoration-none">@Localizer["SEO_Category_Education"]</a></li>
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "tin-tuc-giai-tri")" class="text-decoration-none">@Localizer["SEO_Category_Entertainment"]</a></li>
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "thoi-trang-phu-kien")" class="text-decoration-none">@Localizer["SEO_Category_Fashion"]</a></li>
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "lam-dep-cham-soc-ca-nhan")" class="text-decoration-none">@Localizer["SEO_Category_Beauty"]</a></li>
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "thuc-pham-do-uong")" class="text-decoration-none">@Localizer["SEO_Category_Food"]</a></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled category-links">
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "du-lich")" class="text-decoration-none">@Localizer["SEO_Category_Travel"]</a></li>
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "the-thao-ngoai-troi")" class="text-decoration-none">@Localizer["SEO_Category_Sports"]</a></li>
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "cong-nghe-dien-tu")" class="text-decoration-none">@Localizer["SEO_Category_Tech"]</a></li>
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "phuong-tien-giao-thong")" class="text-decoration-none">@Localizer["SEO_Category_Vehicle"]</a></li>
                                    <li class="mb-2"><i class="bi bi-arrow-right-circle text-primary me-2"></i><a href="@LocalizedUrlHelper.GetCategoryUrl(Context, "tro-choi")" class="text-decoration-none">@Localizer["SEO_Category_Gaming"]</a></li>
                                </ul>
                            </div>
                        </div>

                        <div class="alert alert-info mt-4" role="alert">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            <strong>@Localizer["SEO_CTA_Title"]</strong> @Localizer["SEO_CTA_Text"]
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Category filter function - AJAX load with URL update
        async function filterByCategory(select) {
            const selectedOption = select.options[select.selectedIndex];
            const categoryId = selectedOption.value;
            const slug = selectedOption.getAttribute('data-slug');
            const categoryName = selectedOption.getAttribute('data-name');

            // Update URL without reload using History API
            let newUrl = '/';
            if (slug && slug !== '') {
                newUrl = '/chu-de/' + slug;
            }
            window.history.pushState({ categoryId: categoryId }, '', newUrl);

            // Update category label
            updateCategoryLabel(categoryName);

            // Load top 10 hashtags via AJAX
            await loadTopHashtags(categoryId);
        }

        // Update category label badge
        function updateCategoryLabel(categoryName) {
            const titleContainer = document.querySelector('.card-header .d-flex.align-items-center.gap-3');
            let labelElement = document.getElementById('categoryLabel');

            if (categoryName && categoryName !== '') {
                if (!labelElement) {
                    // Create new label if doesn't exist
                    labelElement = document.createElement('span');
                    labelElement.id = 'categoryLabel';
                    labelElement.className = 'badge bg-white bg-opacity-25 px-3 py-2';
                    titleContainer.appendChild(labelElement);
                }
                labelElement.innerHTML = '<i class="bi bi-tag-fill me-1"></i>' + htmlEscape(categoryName);
            } else {
                // Remove label if "Táº¥t Cáº£ Chá»§ Äá»"
                if (labelElement) {
                    labelElement.remove();
                }
            }
        }

        // Load top 10 hashtags via AJAX
        async function loadTopHashtags(categoryId) {
            try {
                const url = categoryId ? `/Home/GetTopHashtags?categoryId=${categoryId}` : '/Home/GetTopHashtags';
                const response = await fetch(url);

                if (!response.ok) {
                    console.error('Failed to load hashtags');
                    return;
                }

                const hashtags = await response.json();
                renderHashtagTable(hashtags);
            } catch (error) {
                console.error('Error loading hashtags:', error);
            }
        }

        // Render hashtag table
        function renderHashtagTable(hashtags) {
            const tbody = document.querySelector('#hashtagTable tbody');

            if (!hashtags || hashtags.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-5 text-muted">
                            <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                            <p>ChÆ°a cÃ³ hashtag trending nÃ o</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = hashtags.map((hashtag, index) => {
                const viewCountFormatted = formatNumber(hashtag.latestViewCount);
                const postCountFormatted = formatNumber(hashtag.latestPostCount);
                const difficultyBadge = getDifficultyBadge(hashtag.difficultyLevel);
                const difficultyVi = getDifficultyVi(hashtag.difficultyLevel);
                const rankBadge = index < 3 ? 'badge bg-warning text-dark' : 'badge bg-secondary';

                return `
                    <tr style="cursor: pointer;" onclick="window.location.href='/hashtag/${encodeURIComponent(hashtag.tag)}'">
                        <td class="ps-4 fw-bold text-muted">${index + 1}</td>
                        <td>
                            <a href="/hashtag/${encodeURIComponent(hashtag.tag)}" class="text-decoration-none">
                                <strong class="text-primary fs-5">${htmlEscape(hashtag.tagDisplay)}</strong>
                                <div class="text-muted small">
                                    <i class="bi bi-bar-chart"></i> ${hashtag.totalAppearances} láº§n xuáº¥t hiá»‡n
                                </div>
                            </a>
                        </td>
                        <td class="text-center">
                            ${hashtag.categoryName ? `<span class="badge bg-info">${htmlEscape(hashtag.categoryName)}</span>` : '<span class="text-muted">-</span>'}
                        </td>
                        <td class="text-center">
                            <strong class="text-danger">${viewCountFormatted}</strong>
                        </td>
                        <td class="text-center">
                            <strong class="text-success">${postCountFormatted}</strong>
                        </td>
                        <td class="text-center">
                            ${hashtag.difficultyLevel ? `<span class="${difficultyBadge}">${difficultyVi}</span>` : '<span class="text-muted">-</span>'}
                        </td>
                        <td class="text-center">
                            <span class="${rankBadge}">#${hashtag.bestRank}</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Helper functions
        function formatNumber(num) {
            if (!num || num <= 0) return '-';
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toLocaleString();
        }

        function getDifficultyBadge(level) {
            const badges = {
                'Easy': 'badge bg-success',
                'Medium': 'badge bg-warning',
                'Hard': 'badge bg-danger',
                'Very Hard': 'badge bg-dark'
            };
            return badges[level] || 'badge bg-secondary';
        }

        function getDifficultyVi(level) {
            const translations = {
                'Easy': 'Tháº¥p',
                'Medium': 'Trung BÃ¬nh',
                'Hard': 'Cao',
                'Very Hard': 'Ráº¥t Cao'
            };
            return translations[level] || level;
        }

        function htmlEscape(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.categoryId !== undefined) {
                const select = document.getElementById('categorySelect');
                select.value = event.state.categoryId || '';
                loadTopHashtags(event.state.categoryId || null);
            }
        });

        const searchInput = document.getElementById('searchInput');
        const suggestionsDropdown = document.getElementById('suggestionsDropdown');
        let debounceTimer;

        searchInput.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            const query = this.value.trim();

            if (query.length < 2) {
                suggestionsDropdown.style.display = 'none';
                return;
            }

            debounceTimer = setTimeout(() => {
                fetchSuggestions(query);
            }, 300);
        });

        searchInput.addEventListener('focus', function() {
            if (this.value.trim().length >= 2) {
                fetchSuggestions(this.value.trim());
            }
        });

        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !suggestionsDropdown.contains(e.target)) {
                suggestionsDropdown.style.display = 'none';
            }
        });

        async function fetchSuggestions(query) {
            try {
                const response = await fetch(`/api/hashtags/suggest?q=${encodeURIComponent(query)}`);
                if (!response.ok) {
                    suggestionsDropdown.style.display = 'none';
                    return;
                }

                const suggestions = await response.json();

                if (!suggestions || suggestions.length === 0) {
                    suggestionsDropdown.style.display = 'none';
                    return;
                }

                suggestionsDropdown.innerHTML = suggestions.map(item => `
                    <a href="/hashtag/${encodeURIComponent(item.tag)}" class="list-group-item list-group-item-action border-0 border-start border-3 border-white hover-border-primary">
                        <div class="d-flex justify-content-between align-items-center py-2">
                            <div>
                                <strong class="text-primary">${escapeHtml(item.tagDisplay)}</strong>
                                <small class="text-muted ms-2 d-block mt-1">
                                    <i class="bi bi-trophy"></i> Háº¡ng ${item.bestRank} Â·
                                    <i class="bi bi-bar-chart"></i> ${item.totalAppearances} láº§n xuáº¥t hiá»‡n
                                </small>
                            </div>
                            <span class="badge bg-primary rounded-pill">${item.sources.length} nguá»“n</span>
                        </div>
                    </a>
                `).join('');

                suggestionsDropdown.style.display = 'block';
            } catch (error) {
                console.error('Error fetching suggestions:', error);
                suggestionsDropdown.style.display = 'none';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
}

<style>
    .home-hero {
        min-height: 70vh;
        display: flex;
        align-items: center;
        background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
    }

    .search-container input:focus {
        box-shadow: none !important;
    }

    .search-container .input-group:focus-within {
        box-shadow: 0 10px 30px rgba(13, 110, 253, 0.3) !important;
        transform: translateY(-2px);
        transition: all 0.3s ease;
    }

    #suggestionsDropdown {
        max-height: 400px;
        overflow-y: auto;
        border: none;
    }

    #suggestionsDropdown .list-group-item {
        cursor: pointer;
        transition: all 0.2s ease;
    }

    #suggestionsDropdown .list-group-item:hover {
        background-color: #f8f9fa;
        border-left-color: #0d6efd !important;
        transform: translateX(5px);
    }

    .hover-border-primary:hover {
        border-left-color: #0d6efd !important;
    }

    .feature-icon {
        transition: transform 0.3s ease;
    }

    .card:hover .feature-icon {
        transform: scale(1.1) rotate(5deg);
    }

    /* Mobile responsive search button */
    /* Feature card hover effect */
    .feature-card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
    }

    @@media (max-width: 576px) {
        .search-container {
            max-width: 100% !important;
            padding: 0 15px;
        }

        /* Reduce search input group height on mobile */
        .input-group {
            height: 55px !important;
        }

        /* Make search button smaller, hide text on mobile */
        .input-group .btn-primary {
            padding-left: 1.25rem !important;
            padding-right: 1.25rem !important;
            font-size: 0;
        }

        .input-group .btn-primary .bi-search {
            font-size: 1.25rem;
            margin-right: 0 !important;
        }

        .input-group .form-control {
            font-size: 0.95rem !important;
        }

        .input-group .input-group-text {
            padding-left: 1rem !important;
        }

        /* Hide "Äa Nguá»“n Dá»¯ Liá»‡u" card on mobile */
        .row.mt-5.g-4 .col-md-4:nth-child(2) {
            display: none !important;
        }

        /* Make remaining feature cards more compact on mobile */
        .feature-card-hover .card-body {
            padding: 1.5rem 1rem !important;
        }

        .feature-card-hover .feature-icon {
            width: 50px !important;
            height: 50px !important;
            margin-bottom: 0.75rem !important;
        }

        .feature-card-hover .feature-icon i {
            font-size: 1.5rem !important;
        }

        .feature-card-hover h5 {
            font-size: 1rem !important;
            margin-bottom: 0.5rem !important;
        }

        .feature-card-hover p {
            font-size: 0.85rem !important;
        }

        .feature-card-hover small {
            font-size: 0.75rem !important;
        }
    }
</style>
